const missingUQAids = ['66ec69df6db34549b09d4538',
'66fc5526c289b0b4301ad8d8',
'66fc560fc289b0b430351b20',
'67099c1659826fe948ac1aac',
'66fc5526c289b0b4301ad8d8',
'66fc560fc289b0b430351b20',
'67099c5459826fe948aef20c',
'67099c3559826fe948ad93c7',
'67099c5e59826fe948af5c60',
'67099bce59826fe948a8d058',
'67099c5259826fe948aed3fd',
'67099bda59826fe948a95beb',
'67099c1659826fe948ac18ee',
'67099c1d59826fe948ac7240',
'67099c5a59826fe948af3527',
'67099c5959826fe948af2422',
'67099c3559826fe948ad8f2e',
'67099bf559826fe948aa9300',
'67099c4a59826fe948ae872b',
'67099c1459826fe948ac0099',
'67099c4a59826fe948ae80bb',
'67099c5d59826fe948af50a0',
'67099c3d59826fe948adefb0',
'67099c1c59826fe948ac5ceb',
'67099c3e59826fe948adf891',
'67099c3159826fe948ad6532',
'670e2d3a86168d9c8cfa4a5d',
'670e2e4486168d9c8cfb5112',
'670e2f2a86168d9c8cfc0f81',
'670e2d4d86168d9c8cfa55d6',
'670e2dc286168d9c8cfae165',
'670e2e4886168d9c8cfb53a8',
'670e2ec186168d9c8cfbc2c3',
'670e2eff86168d9c8cfbeb45',
'670e2d9986168d9c8cfac39b',
'670e2eea86168d9c8cfbdd89',
'670e2f4086168d9c8cfc2654',
'670e2d9086168d9c8cfabe9f',
'670e2d9786168d9c8cfac28c',
'670e2d9d86168d9c8cfac668',
'670e2eba86168d9c8cfbbb5e',
'670e2ebc86168d9c8cfbbd32',
'670e2ebe86168d9c8cfbbeee',
'670e2ec086168d9c8cfbc1be',
'670e2d6a86168d9c8cfa6499',
'670e2de886168d9c8cfb017f',
'670e2e1a86168d9c8cfb23cf',
'670e2e5986168d9c8cfb651b',
'670e2e5c86168d9c8cfb677e',
'670e2f0986168d9c8cfbf2b1',
'670e2d5b86168d9c8cfa5c94',
'670e2d7286168d9c8cfa6970',
'670e2dbc86168d9c8cfadd5c',
'670e2e4186168d9c8cfb4cb0',
'670e2e6a86168d9c8cfb757a',
'670e2e9a86168d9c8cfb9fd7',
'670e2f5586168d9c8cfc56cd',
'670e2d6886168d9c8cfa6378',
'670e2d8e86168d9c8cfabd9d',
'670e2daa86168d9c8cfad053',
'670e2e1386168d9c8cfb20f6',
'670e2e3e86168d9c8cfb4a27',
'670e2d5f86168d9c8cfa5f0f',
'670e2d9286168d9c8cfac046',
'670e2e2586168d9c8cfb2db8',
'670e2e6786168d9c8cfb70fd',
'670e2ef386168d9c8cfbe316',
'670e2daa86168d9c8cfad0a0',
'670e2daf86168d9c8cfad4cf',
'670e2ebc86168d9c8cfbbd20',
'670e2f2186168d9c8cfc0774',
'670e2d6586168d9c8cfa6208',
'670e2e4786168d9c8cfb52be',
'670e2eb986168d9c8cfbb963',
'670e2f0186168d9c8cfbec8a',
'670e2d2f86168d9c8cfa42ef',
'670e2d6586168d9c8cfa6232',
'670e2d8686168d9c8cfab851',
'670e2dac86168d9c8cfad164',
'670e2e8a86168d9c8cfb9355',
'670e2ecb86168d9c8cfbc9f2',
'670e2f3b86168d9c8cfc1e0f',
'670e2d3a86168d9c8cfa4a5d',
'670e2e4486168d9c8cfb5112',
'670e2f2a86168d9c8cfc0f81',
'670e2d4d86168d9c8cfa55d6',
'670e2dc286168d9c8cfae165',
'670e2e4886168d9c8cfb53a8',
'670e2ec186168d9c8cfbc2c3',
'670e2eff86168d9c8cfbeb45',
'670e2d9986168d9c8cfac39b',
'670e2eea86168d9c8cfbdd89',
'670e2f4086168d9c8cfc2654',
'670e2d0a86168d9c8cfa29d6',
'670e2d9086168d9c8cfabe9f',
'670e2d9786168d9c8cfac28c',
'670e2d9d86168d9c8cfac668',
'670e2eba86168d9c8cfbbb5e',
'670e2ebc86168d9c8cfbbd32',
'670e2ebe86168d9c8cfbbeee',
'670e2ec086168d9c8cfbc1be',
'670e2d6a86168d9c8cfa6499',
'670e2de886168d9c8cfb017f',
'670e2e1a86168d9c8cfb23cf',
'670e2e5986168d9c8cfb651b',
'670e2e5c86168d9c8cfb677e',
'670e2f0986168d9c8cfbf2b1',
'670e2d5b86168d9c8cfa5c94',
'670e2d7286168d9c8cfa6970',
'670e2dbc86168d9c8cfadd5c',
'670e2e4186168d9c8cfb4cb0',
'670e2e6a86168d9c8cfb757a',
'670e2e9a86168d9c8cfb9fd7',
'670e2f5586168d9c8cfc56cd',
'670e2d6886168d9c8cfa6378',
'670e2d8e86168d9c8cfabd9d',
'670e2daa86168d9c8cfad053',
'670e2e1386168d9c8cfb20f6',
'670e2e3e86168d9c8cfb4a27',
'670e2d5f86168d9c8cfa5f0f',
'670e2d9286168d9c8cfac046',
'670e2e2586168d9c8cfb2db8',
'670e2e6786168d9c8cfb70fd',
'670e2ef386168d9c8cfbe316',
'670e2daa86168d9c8cfad0a0',
'670e2daf86168d9c8cfad4cf',
'670e2ebc86168d9c8cfbbd20',
'670e2f2186168d9c8cfc0774',
'670e2d6586168d9c8cfa6208',
'670e2e4786168d9c8cfb52be',
'670e2eb986168d9c8cfbb963',
'670e2f0186168d9c8cfbec8a',
'670e2d2f86168d9c8cfa42ef',
'670e2d6586168d9c8cfa6232',
'670e2d8686168d9c8cfab851',
'670e2dac86168d9c8cfad164',
'670e2e8a86168d9c8cfb9355',
'670e2ecb86168d9c8cfbc9f2',
'670e2f3b86168d9c8cfc1e0f',
'67099c5959826fe948af2c43',
'67099c2859826fe948ace53b',
'670db87586168d9c8c7034a5',
'670e681486168d9c8cb94b3d',
'670e6ab086168d9c8c3b8d70',
'670e6ac986168d9c8c407b29',
'670e6b0c86168d9c8c4d62e8',
'670e6b0586168d9c8c4c1d8c',
'670e6afd86168d9c8c4a9a77',
'670e6af286168d9c8c4898ea',
'670e6b0186168d9c8c4b5f9f',
'670e6af186168d9c8c484d2f',
'670e6afd86168d9c8c4a9606',
'670e6af086168d9c8c4814c6',
'670e6b0c86168d9c8c4d62e8',
'670e6af186168d9c8c4846f6',
'670e6af286168d9c8c489af0',
'670e6b0586168d9c8c4c1d8c',
'670e6af686168d9c8c4951f6',
'670e6b0786168d9c8c4c715f',
'670e6af986168d9c8c49d1c2',
'670e6af386168d9c8c48b2f7',
'670e6b0786168d9c8c4c715f',
'670e6b5586168d9c8c5b7a9e',
'670e690886168d9c8ce80ed3',
'670e693e86168d9c8cf260e9',
'670e6a4086168d9c8c250317',
'670e6a7e86168d9c8c316b43',
'670e693486168d9c8cf06d33',
'670e698186168d9c8cff5071',
'670e698186168d9c8cff5078',
'670e6a4686168d9c8c263199',
'670e695486168d9c8cf699c3',
'670e695586168d9c8cf6d0fd',
'670e69ef86168d9c8c14d1a4',
'670e69fc86168d9c8c175c2f',
'670e698c86168d9c8c0132bd',
'670e69ab86168d9c8c074e5c',
'670e6af186168d9c8c484f21',
'670e693886168d9c8cf14551',
'670e69ff86168d9c8c1803cb',
'670e69cb86168d9c8c0da9f2',
'670e69e886168d9c8c136e8f',
'670e6a4c86168d9c8c2767fe',
'670e6a9786168d9c8c368ebf',
'670e6ad086168d9c8c41d153',
'670e697086168d9c8cfc0978',
'670e6aa686168d9c8c397efd',
'670e697f86168d9c8cfeee3f',
'670e69e486168d9c8c12995b',
'670e69e486168d9c8c129960',
'670e6a2d86168d9c8c2158e9',
'670e6aff86168d9c8c4ae91d',
'670e6b3386168d9c8c54f543',
'670e692186168d9c8cecdb59',
'670e692186168d9c8cecdb64',
'670e695786168d9c8cf72abb',
'670e69c586168d9c8c0c7a84',
'670e69d486168d9c8c0f62e5',
'670e6acd86168d9c8c414fd5',
'670e693086168d9c8cefcd7e',
'670e693086168d9c8cefcd83',
'670e693686168d9c8cf0c5a0',
'670e69c486168d9c8c0c641f',
'670e69f486168d9c8c15c36e',
'670e6a9186168d9c8c352939',
'670e6a2786168d9c8c203bac',
'670e6a2a86168d9c8c20c874',
'670e6a9c86168d9c8c377350',
'670e6ab286168d9c8c3bd38c',
'670e6ad986168d9c8c43a131',
'670e6b5586168d9c8c5b7a9e',
'670e6a9786168d9c8c367413',
'670e6b3886168d9c8c55ed59',
'670e6b3886168d9c8c55ed61',
'670e6ad086168d9c8c41e071',
'670e699786168d9c8c034aa5',
'670e6a8e86168d9c8c34848a',
'670e6b0586168d9c8c4c3222',
'670e695e86168d9c8cf88bc6',
'670e69d686168d9c8c0fc465',
'670e6a1f86168d9c8c1e9d15',
'670e69ad86168d9c8c079f9b',
'670e6a0886168d9c8c19d35e',
'670e6a0886168d9c8c19e32e',
'670e6a0886168d9c8c19e336',
'670e6a0886168d9c8c19e33e',
'670e6a0886168d9c8c19e344',
'670e6a0886168d9c8c19e34c',
'670e699686168d9c8c031e5a',
'670e699786168d9c8c03736e',
'670e6b4b86168d9c8c59a820',
'670e697a86168d9c8cfdf623',
'670e697c86168d9c8cfe4a25',
'670e697d86168d9c8cfe6c49',
'670e697d86168d9c8cfe8f84',
'670e697e86168d9c8cfeaf58',
'670e697f86168d9c8cfecc03',
'670e697f86168d9c8cfeecf5',
'670e698086168d9c8cff092b',
'670e698186168d9c8cff2727',
'670e698186168d9c8cff272e',
'670e698386168d9c8cff9275',
'670e6aca86168d9c8c40bd4f',
'670e6ade86168d9c8c44ad12',
'670e693286168d9c8cf025e9',
'670e693986168d9c8cf168e5',
'670e696f86168d9c8cfbc6d0',
'670e6b9286168d9c8c67c0fc',
'670e6b9686168d9c8c689524',
'670e6b8786168d9c8c6591fd',
'670e6b9686168d9c8c68a9bf',
'670e6b9286168d9c8c67c0fc',
'670e6b9686168d9c8c689524',
'670e6b8786168d9c8c6591fd',
'670e6b9686168d9c8c68a9bf',
'670f33b886168d9c8cd60497',
'670f33b886168d9c8cd60497',
'670fb94a86168d9c8cafc9f4',
'670ff2cb86168d9c8cbc6296',
]

const knex = require("knex");
const { isEmpty } = require("lodash");
const { MongoClient, ObjectId } = require("mongodb");
require('dotenv').config({path: __dirname + '/.env'})



const getRedshift = () =>
  knex({
    client: "redshift",
    searchPath: [process.env.REDSHIFT_DB_SCHEMA || "edulastic"],
    connection: {
      host: process.env.REDSHIFT_DB_HOST || "localhost",
      user: process.env.REDSHIFT_DB_USER || "dbuser",
      password: process.env.REDSHIFT_DB_PASSWORD,
      database: process.env.REDSHIFT_DB_NAME || "edulastic",
      port: process.env.REDSHIFT_DB_PORT || 5439,
    },
    pool: { min: 1, max: 2 },
    acquireConnectionTimeout: 30000,
  });

const getMongoClient = async () =>
  MongoClient.connect(process.env.DB_URI, {
    useNewUrlParser: true,
    useUnifiedTopology: true,
  });

(async () => {
  let redshift;
  let client;
  try {
    client = await getMongoClient();
    redshift = getRedshift();
    console.log("Connected to DBs");
    const db = client.db();
    const mongoUqas = [];
    let counter = 0;
    await db.collection("VUserQuestionActivities").find({
      _id: { $in: missingUQAids.map((id) => new ObjectId(id))}
    }).forEach(doc => {
      console.log(JSON.stringify(doc, null, 2))
      if (counter % 10000 === 0) {
        console.log(counter)
      }
      counter++;
      mongoUqas.push({
        id: doc._id,
        standards: doc.standards
      })
    })
    console.log('Total Mongo UQAs', mongoUqas.length)
    console.log('UQAs', JSON.stringify(mongoUqas, null, 2))
    const invalidUqas = []
    const validUqas = []
    mongoUqas.forEach(({ _id, standards}) => {
        if (isEmpty(standards)) {
            invalidUqas.push(_id)
        } else {
            validUqas.push(_id)
        }
    })
    console.log('Total missing uqas with no standards', invalidUqas.length)
    console.log('Total missing valid uqas', validUqas)
    console.log('VALID MISSING UQAs', JSON.stringify(validUqas, null, 2))
  } catch (e) {
    console.log("Error occurred\nerror => ", e);
  } finally {
    process.exit()
  }
})();